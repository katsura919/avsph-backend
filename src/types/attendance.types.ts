import { z } from 'zod';

// Attendance status enum
export const attendanceStatusEnum = z.enum([
    'pending',
    'approved',
    'rejected'
]);

// Attendance schema
export const attendanceSchema = z.object({
    _id: z.string().optional(),
    staffId: z.string().min(1, 'Staff ID is required'),
    businessId: z.string().min(1, 'Business ID is required'),
    clockIn: z.string().datetime(),
    clockOut: z.string().datetime().optional(),
    hoursWorked: z.number().optional(),
    status: attendanceStatusEnum.default('pending'),
    notes: z.string().max(500).optional(),
    adminNotes: z.string().max(500).optional(),
    approvedBy: z.string().optional(),
    approvedAt: z.string().datetime().optional(),
    isActive: z.boolean().default(true),
    createdAt: z.string().datetime().optional(),
    updatedAt: z.string().datetime().optional(),
});

// Schema for clocking in
export const clockInSchema = z.object({
    notes: z.string().max(500).optional(),
});

// Schema for clocking out
export const clockOutSchema = z.object({
    notes: z.string().max(500).optional(),
});

// Schema for admin to approve/reject attendance
export const approveAttendanceSchema = z.object({
    status: z.enum(['approved', 'rejected']),
    adminNotes: z.string().max(500).optional(),
});

// Schema for admin to edit attendance
export const editAttendanceSchema = z.object({
    clockIn: z.string().datetime().optional(),
    clockOut: z.string().datetime().optional(),
    notes: z.string().max(500).optional(),
    adminNotes: z.string().max(500).optional(),
    status: attendanceStatusEnum.optional(),
});

// Type exports
export type Attendance = z.infer<typeof attendanceSchema>;
export type ClockIn = z.infer<typeof clockInSchema>;
export type ClockOut = z.infer<typeof clockOutSchema>;
export type ApproveAttendance = z.infer<typeof approveAttendanceSchema>;
export type EditAttendance = z.infer<typeof editAttendanceSchema>;

// JSON Schemas for Fastify route validation
export const attendanceJsonSchema = {
    type: 'object',
    properties: {
        _id: { type: 'string' },
        staffId: { type: 'string' },
        businessId: { type: 'string' },
        clockIn: { type: 'string', format: 'date-time' },
        clockOut: { type: 'string', format: 'date-time' },
        hoursWorked: { type: 'number' },
        status: { type: 'string', enum: ['pending', 'approved', 'rejected'] },
        notes: { type: 'string', maxLength: 500 },
        adminNotes: { type: 'string', maxLength: 500 },
        approvedBy: { type: 'string' },
        approvedAt: { type: 'string', format: 'date-time' },
        isActive: { type: 'boolean' },
        createdAt: { type: 'string', format: 'date-time' },
        updatedAt: { type: 'string', format: 'date-time' },
    },
    required: ['staffId', 'businessId', 'clockIn'],
} as const;

export const clockInJsonSchema = {
    type: 'object',
    properties: {
        notes: { type: 'string', maxLength: 500 },
    },
} as const;

export const clockOutJsonSchema = {
    type: 'object',
    properties: {
        notes: { type: 'string', maxLength: 500 },
    },
} as const;

export const approveAttendanceJsonSchema = {
    type: 'object',
    properties: {
        status: { type: 'string', enum: ['approved', 'rejected'] },
        adminNotes: { type: 'string', maxLength: 500 },
    },
    required: ['status'],
} as const;

export const editAttendanceJsonSchema = {
    type: 'object',
    properties: {
        clockIn: { type: 'string', format: 'date-time' },
        clockOut: { type: 'string', format: 'date-time' },
        notes: { type: 'string', maxLength: 500 },
        adminNotes: { type: 'string', maxLength: 500 },
        status: { type: 'string', enum: ['pending', 'approved', 'rejected'] },
    },
} as const;
