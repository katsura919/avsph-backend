import { z } from 'zod';

// Staff status enum
export const staffStatusEnum = z.enum([
    'active',
    'on_leave',
    'terminated'
]);

// Employment type enum
export const employmentTypeEnum = z.enum([
    'full-time',
    'part-time',
    'contract'
]);

// Document schema for staff documents
export const staffDocumentSchema = z.object({
    name: z.string().min(1).max(100),
    url: z.string().url(),
    type: z.string().min(1).max(50),
    uploadedAt: z.string().datetime(),
});

// Staff schema
export const staffSchema = z.object({
    _id: z.string().optional(),
    firstName: z.string().min(1, 'First name is required').max(50),
    lastName: z.string().min(1, 'Last name is required').max(50),
    email: z.string().email('Invalid email address'),
    password: z.string().min(8, 'Password must be at least 8 characters'),
    phone: z.string().max(20).optional(),
    position: z.string().min(1, 'Position is required').max(100),
    department: z.string().max(100).optional(),
    dateHired: z.string().datetime({ message: 'Invalid date format' }),
    salary: z.number().positive().optional(),
    employmentType: employmentTypeEnum.default('full-time'),
    businessId: z.string().min(1, 'Business ID is required'),
    status: staffStatusEnum.default('active'),
    notes: z.string().max(1000).optional(),
    photoUrl: z.string().url().optional(),
    documents: z.array(staffDocumentSchema).optional(),
    isActive: z.boolean().default(true),
    createdAt: z.string().datetime().optional(),
    updatedAt: z.string().datetime().optional(),
});

// Schema for creating a new staff member (admin only)
export const createStaffSchema = staffSchema.omit({
    _id: true,
    status: true,
    notes: true,
    photoUrl: true,
    documents: true,
    isActive: true,
    createdAt: true,
    updatedAt: true,
});

// Schema for updating a staff member (admin only)
export const updateStaffSchema = z.object({
    firstName: z.string().min(1).max(50).optional(),
    lastName: z.string().min(1).max(50).optional(),
    email: z.string().email().optional(),
    phone: z.string().max(20).optional(),
    position: z.string().min(1).max(100).optional(),
    department: z.string().max(100).optional(),
    dateHired: z.string().datetime().optional(),
    salary: z.number().positive().optional(),
    employmentType: employmentTypeEnum.optional(),
    status: staffStatusEnum.optional(),
    notes: z.string().max(1000).optional(),
    isActive: z.boolean().optional(),
});

// Staff login schema
export const staffLoginSchema = z.object({
    email: z.string().email('Invalid email address'),
    password: z.string().min(1, 'Password is required'),
    businessId: z.string().min(1, 'Business ID is required'),
});

// Staff change password schema
export const staffChangePasswordSchema = z.object({
    currentPassword: z.string().min(1, 'Current password is required'),
    newPassword: z.string().min(8, 'New password must be at least 8 characters'),
});

// Type exports
export type StaffLogin = z.infer<typeof staffLoginSchema>;
export type StaffChangePassword = z.infer<typeof staffChangePasswordSchema>;

// JSON Schemas for Fastify route validation
export const staffDocumentJsonSchema = {
    type: 'object',
    properties: {
        name: { type: 'string', minLength: 1, maxLength: 100 },
        url: { type: 'string', format: 'uri' },
        type: { type: 'string', minLength: 1, maxLength: 50 },
        uploadedAt: { type: 'string', format: 'date-time' },
    },
    required: ['name', 'url', 'type', 'uploadedAt'],
} as const;

export const staffJsonSchema = {
    type: 'object',
    properties: {
        _id: { type: 'string' },
        firstName: { type: 'string', minLength: 1, maxLength: 50 },
        lastName: { type: 'string', minLength: 1, maxLength: 50 },
        email: { type: 'string', format: 'email' },
        phone: { type: 'string', maxLength: 20 },
        position: { type: 'string', minLength: 1, maxLength: 100 },
        department: { type: 'string', maxLength: 100 },
        dateHired: { type: 'string', format: 'date-time' },
        salary: { type: 'number' },
        employmentType: { type: 'string', enum: ['full-time', 'part-time', 'contract'] },
        businessId: { type: 'string' },
        status: { type: 'string', enum: ['active', 'on_leave', 'terminated'] },
        notes: { type: 'string', maxLength: 1000 },
        photoUrl: { type: 'string', format: 'uri' },
        documents: { type: 'array', items: staffDocumentJsonSchema },
        isActive: { type: 'boolean' },
        createdAt: { type: 'string', format: 'date-time' },
        updatedAt: { type: 'string', format: 'date-time' },
    },
    required: ['firstName', 'lastName', 'email', 'position', 'dateHired', 'businessId'],
} as const;

export const createStaffJsonSchema = {
    type: 'object',
    properties: {
        firstName: { type: 'string', minLength: 1, maxLength: 50 },
        lastName: { type: 'string', minLength: 1, maxLength: 50 },
        email: { type: 'string', format: 'email' },
        password: { type: 'string', minLength: 8 },
        phone: { type: 'string', maxLength: 20 },
        position: { type: 'string', minLength: 1, maxLength: 100 },
        department: { type: 'string', maxLength: 100 },
        dateHired: { type: 'string', format: 'date-time' },
        salary: { type: 'number' },
        employmentType: { type: 'string', enum: ['full-time', 'part-time', 'contract'] },
        businessId: { type: 'string' },
    },
    required: ['firstName', 'lastName', 'email', 'password', 'position', 'dateHired', 'businessId'],
} as const;

export const updateStaffJsonSchema = {
    type: 'object',
    properties: {
        firstName: { type: 'string', minLength: 1, maxLength: 50 },
        lastName: { type: 'string', minLength: 1, maxLength: 50 },
        email: { type: 'string', format: 'email' },
        phone: { type: 'string', maxLength: 20 },
        position: { type: 'string', minLength: 1, maxLength: 100 },
        department: { type: 'string', maxLength: 100 },
        dateHired: { type: 'string', format: 'date-time' },
        salary: { type: 'number' },
        employmentType: { type: 'string', enum: ['full-time', 'part-time', 'contract'] },
        status: { type: 'string', enum: ['active', 'on_leave', 'terminated'] },
        notes: { type: 'string', maxLength: 1000 },
        isActive: { type: 'boolean' },
    },
} as const;

export const staffLoginJsonSchema = {
    type: 'object',
    properties: {
        email: { type: 'string', format: 'email' },
        password: { type: 'string', minLength: 1 },
        businessId: { type: 'string' },
    },
    required: ['email', 'password', 'businessId'],
} as const;

export const staffLoginResponseJsonSchema = {
    type: 'object',
    properties: {
        token: { type: 'string' },
        staff: staffJsonSchema,
    },
    required: ['token', 'staff'],
} as const;

export const staffChangePasswordJsonSchema = {
    type: 'object',
    properties: {
        currentPassword: { type: 'string', minLength: 1 },
        newPassword: { type: 'string', minLength: 8 },
    },
    required: ['currentPassword', 'newPassword'],
} as const;

